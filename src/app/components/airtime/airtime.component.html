<div class="airtime-page min-h-screen bg-gray-50 flex flex-col">
  <app-header></app-header>

  <main class="flex-1 p-4 sm:p-10">
    <h3 class="text-lg sm:text-2xl font-bold text-secondary mb-4">Purchase Airtime</h3>

    <!-- Saved Mobile Numbers -->
    <section class="mb-6">
      <h3 class="font-bold mb-3 text-base sm:text-xl">Saved Mobile Numbers</h3>

      <!-- Add Form -->
      <div class="flex flex-col sm:flex-row gap-3 items-center mb-5">
        <input
          [(ngModel)]="newMobile"
          placeholder="Add new mobile number"
          class="border-2 border-gray-300 rounded-xl px-3 py-2 text-sm sm:text-base w-full sm:flex-1"
        />
        <button
          (click)="addMobile()"
          class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-xl text-sm sm:text-base w-full sm:w-auto sm:min-w-[100px]"
        >
          Add
        </button>
      </div>

      <!-- Mobile List -->
      <div class="space-y-3 text-sm sm:text-base">
        <div
          *ngFor="let mobile of mobileNumbers"
          class="flex justify-between items-center bg-white p-3 rounded-xl shadow gap-3"
        >
          <span class="break-words text-left flex-1">{{ mobile }}</span>
          <div class="flex gap-2">
            <button
              (click)="deleteMobile(mobile)"
              class="bg-red-600 hover:bg-red-700 text-white font-bold py-1.5 px-3 rounded text-xs sm:text-sm"
            >
              Delete
            </button>
            <button
              (click)="selectMobile(mobile)"
              class="bg-green-600 hover:bg-green-700 text-white font-bold py-1.5 px-3 rounded text-xs sm:text-sm"
            >
              Select
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Airtime Purchase Form -->
    <form [formGroup]="airtimeForm" (ngSubmit)="purchaseAirtime()" class="flex flex-col gap-4 text-sm sm:text-base">
      <!-- Product Select -->
      <div>
        <label for="airtimeProduct" class="block font-bold mb-1">Select Airtime Product:</label>
        <select
          id="airtimeProduct"
          formControlName="airtimeProduct"
          required
          class="w-full border-2 border-gray-300 rounded-xl px-3 py-2"
        >
          <option *ngFor="let product of airtimeProducts" [ngValue]="product">
            {{ product.product_description }} - R{{ product.product_value }}
          </option>
        </select>
      </div>

      <!-- Mobile Input -->
      <div>
        <label for="airtimeMobileNumber" class="block font-bold mb-1">Mobile Number:</label>
        <input
          id="airtimeMobileNumber"
          type="text"
          inputmode="numeric"
          formControlName="airtimeMobileNumber"
          class="w-full border-2 border-gray-300 rounded-xl px-3 py-2"
        />
        <p *ngIf="airtimeForm.get('airtimeMobileNumber')?.touched && airtimeForm.get('airtimeMobileNumber')?.invalid" class="text-red-600 text-xs mt-1">
          Mobile number must be exactly 10 digits.
        </p>
      </div>

      <!-- Amount Input -->
      <div>
        <label for="airtimeAmount" class="block font-bold mb-1">Amount:</label>
        <div class="relative w-full">
          <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500">R</span>
          <input
            id="airtimeAmount"
            type="number"
            formControlName="airtimeAmount"
            class="w-full border-2 border-gray-300 rounded-xl pl-8 pr-4 py-2"
          />
        </div>
        <p *ngIf="airtimeForm.get('airtimeAmount')?.touched && airtimeForm.get('airtimeAmount')?.invalid" class="text-red-600 text-xs mt-1">
          Minimum amount is R2.
        </p>
      </div>

      <!-- Submit Button -->
      <button
        type="submit"
        [disabled]="airtimeForm.invalid || isLoading"
        class="bg-green-600 hover:bg-green-700 text-white font-extrabold py-3 px-5 rounded-xl text-sm sm:text-base w-full"
      >
        <span *ngIf="!isLoading">Buy Airtime</span>
        <span *ngIf="isLoading">Processing...</span>
      </button>

      <!-- Spinner -->
      <div *ngIf="isLoading" class="flex justify-center items-center mt-4">
        <div class="animate-spin rounded-full h-8 w-8 border-t-4 border-green-600 border-solid"></div>
      </div>
    </form>
  </main>

  <!-- Home Button -->
  <button
    (click)="goHome()"
    style="bottom: 1rem; left: 1rem;"
    class="fixed bg-green-600 hover:bg-green-700 text-white font-extrabold py-4 px-6 rounded-xl text-sm sm:text-2xl shadow-xl"
  >
    Home
  </button>
</div>
