<div class="data-page min-h-screen bg-gray-50">
  <app-header></app-header>

  <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="bg-white shadow-md rounded-lg p-6 sm:p-8">
      <h3 class="text-3xl font-semibold text-secondary mb-6">Purchase Data</h3>

      <!-- Saved Mobile Numbers -->
      <section class="mb-8">
        <h3 class="font-bold mb-6 text-3xl sm:text-4xl">Saved Mobile Numbers</h3>

        <!-- Add Form -->
        <div class="grid grid-cols-[1fr_auto] gap-6 items-center mb-10">
          <input
            [(ngModel)]="newMobile"
            placeholder="Add new mobile number"
            class="border-2 border-gray-300 rounded-xl px-8 py-6 text-2xl sm:text-3xl w-full"
          />
          <button
            (click)="addMobile()"
            class="bg-green-600 hover:bg-green-700 text-white font-bold py-6 px-10 rounded-xl text-2xl sm:text-3xl w-full sm:w-auto min-w-[160px]"
          >
            Add
          </button>
        </div>

        <!-- Mobile List -->
        <div class="space-y-6 text-2xl sm:text-3xl">
          <div
            *ngFor="let mobile of mobileNumbers"
            class="grid grid-cols-1 sm:grid-cols-[1fr_auto_auto] items-center bg-gray-50 p-4 rounded-xl shadow gap-4"
          >
            <span class="break-words">{{ mobile }}</span>

            <!-- Delete Button -->
            <button
              (click)="deleteMobile(mobile)"
              class="bg-red-600 hover:bg-red-700 text-white font-bold py-6 px-10 rounded-xl w-full sm:w-auto min-w-[140px]"
            >
              Delete
            </button>

            <!-- Select Button -->
            <button
              (click)="selectMobile(mobile)"
              class="bg-green-600 hover:bg-green-700 text-white font-bold py-6 px-10 rounded-xl w-full sm:w-auto min-w-[140px]"
            >
              Select
            </button>
          </div>
        </div>
      </section>

      <!-- Data Purchase Form -->
      <form (ngSubmit)="purchaseData()" class="flex flex-col gap-10 text-2xl sm:text-3xl">
        <div>
          <label for="dataProduct" class="block text-2xl sm:text-3xl font-bold mb-4">Select Data Product:</label>
          <select
            id="dataProduct"
            [(ngModel)]="selectedDataProduct"
            name="dataProduct"
            required
            (change)="onProductChange()"
            class="w-full border-2 border-gray-300 rounded-xl px-8 py-6 text-2xl sm:text-3xl"
          >
            <option *ngFor="let product of dataProducts" [ngValue]="product">
              {{ product.product_description }} - R{{ product.product_value }}
            </option>
          </select>
        </div>
      
        <div>
          <label for="dataMobileNumber" class="block text-2xl sm:text-3xl font-bold mb-4">Mobile Number:</label>
          <input
            type="text"
            id="dataMobileNumber"
            [(ngModel)]="dataMobileNumber"
            name="dataMobileNumber"
            inputmode="numeric"
            required
            class="w-full border-2 border-gray-300 rounded-xl px-8 py-6 text-2xl sm:text-3xl"
          />
        </div>
      
        <div>
          <label for="dataAmount" class="block text-2xl sm:text-3xl font-bold mb-4">Amount:</label>
          <div class="relative w-full">
            <span class="absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl sm:text-3xl text-gray-500">R</span>
            <input
              type="number"
              id="dataAmount"
              [(ngModel)]="dataInputValue"
              name="dataAmount"
              required
              class="w-full border-2 border-gray-300 rounded-xl pl-14 pr-8 py-6 text-2xl sm:text-3xl"
            />
          </div>
        </div>
      
        <!-- Submit Button -->
        <button
          type="submit"
          [disabled]="
            !selectedDataProduct || 
            !dataMobileNumber || 
            !dataInputValue || 
            dataInputValue > availableAirtimeLimit || 
            isLoading
          "
          class="bg-green-600 hover:bg-green-700 text-white font-extrabold py-6 px-10 rounded-xl text-2xl sm:text-3xl w-full"
        >
          <span *ngIf="!isLoading">Buy Data</span>
          <span *ngIf="isLoading">Processing...</span>
        </button>

        <!-- Low Balance Warning -->
        <p class="text-red-600 font-semibold" *ngIf="dataInputValue > availableAirtimeLimit">
          You do not have enough funds available.
        </p>

        <!-- Spinner -->
        <div *ngIf="isLoading" class="flex justify-center items-center mt-10">
          <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-green-600 border-solid"></div>
        </div>
      </form>
    </div>
  </main>

  <!-- Home Button -->
  <button
    (click)="goHome()"
    style="bottom: 3rem; left: 4rem;"
    class="fixed bg-green-600 hover:bg-green-700 text-white font-extrabold py-10 px-14 rounded-xl text-3xl sm:text-4xl shadow-xl"
  >
    Home
  </button>
</div>
